<% content_for(:title) do %>
<%=h @quiz.title %>
<% end %>

<% content_for(:header) do %>
  <%= gmap_api_include %>

  <style type="text/css">
    #map {
      border : 1px solid #979797;
      width : 100%;
      height : 575px;
    }
  </style>

  <%= javascript_include_tag "kokodoko" %>

  <script type="text/javascript">
    var ary = new Array();
    <% for m in @marks.entries %>
    ary.push({
      title: "<%= m.title %>",
      latlng: new GLatLng(<%= m.lat %>,<%= m.lng %>),
      scale: { magnify: <%= m.magnify_scale || @quiz.magnify_scale %>, normal: 16, demagnify: 15 }
    });
    <% end %>
    shuffle(ary);

    quiz.questions = ary;
    quiz.num_questions = <%= @quiz.num_questions %>;
    quiz.view_type = "<%= @quiz.view_type %>";

    Event.observe(window, 'load', function() {
//    jQuery("pbar").progressbar({
//      interval: 2000
//    });
//    jQuery("pbar").progressbar("start");

      var modal = Control.Modal.open($('modal_content'),{
        closeOnClick: 'overlay',
        overlayOpacity: 0.75,
        fade: true
      });
    var afterClose = function() {
      new PeriodicalExecuter(function() {
          pbar2.setPercentage('+1%');
        },
        0.5
      );
    };
    modal.observe('afterClose', afterClose);
    
      pbar2 = new JS_BRAMUS.jsProgressBar($('progress_bar2'), 0, {
        animate: true,
        showText: false,
        boxImage: '/kokodoko/images/bramus/percentImage.png',
        barImage: Array('/kokodoko/images/bramus/percentImage_back1.png',
          '/kokodoko/images/bramus/percentImage_back2.png',
          '/kokodoko/images/bramus/percentImage_back3.png',
          '/kokodoko/images/bramus/percentImage_back4.png'
        ),
        onTick: function(pbObj) {
          if (pbObj.getPercentage() == 100) {
            window.alert("time up!");
            $('new_score').submit();
          };
          return true;
        }
      });

    });
  </script>
<% end %>

<div class="percentImage1" id="progress_bar2">[ Loading Progress Bar ]</div>

<div id="modal_content">
<em>Click to Start</em>
</div>

  <div id="quiz">
      <div id="pano" style="width: 500px; height: 300px"></div>
      <div id="map" style="width: 800px; height: 600px"></div>
      <div id="ansmap" style="width: 500px; height: 300px"></div>
      <div id="hint" style="width: 500px; height: 300px"></div>
  </div>
  <input id="answer" type="text" onfocus="this.select()"></input>
  <input type="button" onclick="quiz.test()" value="答え合わせ"></input>
  <% if @quiz.view_type == "satellite" %>
  <input type="button" onclick="quiz.demagnify()" value="広域"></input>
  <input type="button" onclick="quiz.normal_scale()" value="通常"></input>
  <input type="button" onclick="quiz.magnify()" value="詳細"></input>
  <input type="button" onclick="quiz.show_hint()" value="ヒント"></input>
  <% end %>
  <input type="button" onclick="quiz.give_up()" value="ギブアップ"></input>
  <br/>
  <div id="point"></div>
  <div id="total"></div>
  <div id="message"></div>
  <div id="rate"></div>
  <div id="q_rest"></div>
  <% @score = Score.new; @score.user = session[:user_id]; @score.quiz = @quiz %>
  <div style="display:none">
  <% form_for @score do |f| %>
  <%= f.text_field :score %>
  <%= f.text_field :user_id %>
  <%= f.text_field :quiz_id %>
  <%= f.submit "Send" %>
  <% end %>
  </div>
